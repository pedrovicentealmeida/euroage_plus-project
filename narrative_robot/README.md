# `narrative_robot` ROS 2 Package

## Package Description

The `narrative_robot` package aims to integrate the services of `story_telling` and `speech_services` to create an interactive storytelling system. The robot is capable of narrating stories using voice generated by OpenAI’s assistant, while also allowing users to interact with the story and influence its course through voice commands.

### Key Features

- **Interactive Storytelling**: Users can engage with the robot through voice interactions, influencing the course of the story and guiding the narrative.
- **Voice Output**: The robot uses OpenAI's assistant to generate voice responses based on the story context, making the interaction feel more immersive and dynamic.

### Python-Based Implementation

This package is implemented in Python, offering flexibility for developers to extend and integrate these functionalities into ROS 2 projects. The two main components of the package are:

- **`game_library.py`**: A custom Python library that simplifies the use of services from the `story_telling` and `speech_services` packages. It provides high-level methods to interact with these services.
- **`robot.py`**: The main script that processes information from the GUI (or other sources) to control the robot's actions, such as speaking, listening, and setting story parameters.

### Launch File Support

The package includes a launch file to streamline deployment:

- **`narrative_robot_launch.py`**: This launch file starts the necessary services from both `speech_services` and `story_telling` packages to get the robot up and running.

## Dependencies

### ROS 2 Dependencies

The `narrative_robot` package relies on the following ROS 2 packages:
- `story_telling`: For generating and managing story content.
- `speech_services`: For handling voice synthesis and recognition.

These dependencies are already outlined in the respective packages.

### Python Dependencies

In addition to the ROS 2 dependencies, the package uses the following Python libraries:
- **`rclpy`**: ROS 2 Python client library.
- **`openai`**: To interact with OpenAI's assistant for story generation and responses.

## Example Usage

### Example Python Script

Below is an example of how to use the `game_library.py`, which is central to this package:

```python
#!/usr/bin/env python3

import threading
import rclpy
from game_library import StoryTelling

rclpy.init(args=None)
ST = StoryTelling()

def main():
    try:
        while True:
            ros_thread = threading.Thread(target=rclpy.spin, args=(ST,))
            ros_thread.start()

            # Define parameters for the story (e.g., participant details, story theme)
            ST.define_parameters(
                name="Pedro", 
                age=90, 
                brain="None", 
                hobbies="talking", 
                profession="Carpenter", 
                family="Vitor: Grandson", 
                theme="Walk on the beach", 
                forbidden_topics="Wife's death"
            )
            
            while True:
                # Obtain response from the assistant (based on the current story context)
                ST.obtain_response()

                # Send a new message to the assistant to continue the story
                ST.new_message()
    
    finally:
        # Clean up and shutdown ROS 2
        ST.shutdown_hook()
        ST.destroy_node()
        rclpy.shutdown()

if __name__ == "__main__":
    main()
```
In this script, the StoryTelling class from game_library.py is used to define story parameters, obtain responses from OpenAI's assistant, and send new messages to further the story.

### Launching the Package

To launch the `narrative_robot` package, use the provided launch file:

```bash
ros2 launch narrative_robot narrative_robot_launch.py
```

This will start all the core components of the storyteller robot, allowing it to begin narrating interactive stories and respond to voice interactions.

## Acknowledgments

Special thanks to:
- **Prof. Doutor Rui P. Rocha** (rprocha@isr.uc.pt) for his continuous guidance, support, and motivation throughout this project.
- **Prof. Doutor Fernando Perdigão** (fp@deec.uc.pt) for his for his valuable and critical insights.


## Contact

For any issues or further inquiries, feel free to contact the package maintainers at pedro.almeida@isr.uc.pt.
